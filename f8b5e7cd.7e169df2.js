(window.webpackJsonp=window.webpackJsonp||[]).push([[67],{133:function(e,t,s){"use strict";s.r(t),s.d(t,"frontMatter",(function(){return l})),s.d(t,"metadata",(function(){return r})),s.d(t,"toc",(function(){return b})),s.d(t,"default",(function(){return d}));var n=s(3),c=s(7),a=(s(0),s(143)),o=s(271),l={id:"websockets",title:"Real-time data"},r={unversionedId:"websockets",id:"websockets",isDocsHomePage:!1,title:"Real-time data",description:"RESTED_DEV allows you to listen to changes on your endpoints using websockets.",source:"@site/docs/websockets.md",slug:"/websockets",permalink:"/docs/websockets",version:"current",sidebar:"docs",previous:{title:"Delete a file (DELETE)",permalink:"/docs/file-uploads/upload-delete"},next:{title:"JSONata, query and transform",permalink:"/docs/jsonata"}},b=[{value:"Example",id:"example",children:[{value:"Usage example",id:"usage-example",children:[]}]},{value:"Connection",id:"connection",children:[{value:"Request Cookies",id:"request-cookies",children:[]},{value:"Request Parameters",id:"request-parameters",children:[]}]},{value:"Response data / messages",id:"response-data--messages",children:[{value:"Error codes",id:"error-codes",children:[]},{value:"Successful response",id:"successful-response",children:[]}]}],u={toc:b};function d(e){var t=e.components,s=Object(c.a)(e,["components"]);return Object(a.b)("wrapper",Object(n.a)({},u,s,{components:t,mdxType:"MDXLayout"}),Object(a.b)("p",null,"RESTED_DEV allows you to listen to changes on your endpoints using ",Object(a.b)("strong",{parentName:"p"},"websockets"),"."),Object(a.b)("p",null,"To do this, you use the same endpoint created under projects, using the protocol ",Object(a.b)("strong",{parentName:"p"},"wss")," instead of ",Object(a.b)("strong",{parentName:"p"},"https"),"."),Object(a.b)("h2",{id:"example"},"Example"),Object(a.b)("p",null,"Your endpoint:"),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"https"),"://app.rested.dev/api/1/ce/examples/unsecure-endpoint?key=d59eb2859c284168ac48aef65046d5dd"),Object(a.b)("p",null),Object(a.b)("p",null,"Usage with websockets:"),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"wss"),"://app.rested.dev/api/1/ce/examples/unsecure-endpoint?key=d59eb2859c284168ac48aef65046d5dd"),Object(a.b)("h3",{id:"usage-example"},"Usage example"),Object(a.b)("pre",null,Object(a.b)("code",Object(n.a)({parentName:"pre"},{className:"language-javascript"}),"function websocketExample() {\n  console.log('Creating socket');\n  let socket = new WebSocket(\n    'wss://app.rested.dev/api/1/ce/examples/unsecure-endpoint?key=d59eb2859c284168ac48aef65046d5dd'\n  );\n\n  socket.onopen = () => {\n    console.log('Socket open.');\n  };\n\n  socket.onmessage = (message) => {\n    const data = JSON.parse(message.data);\n    console.log('Socket server message', data);\n  };\n\n  socket.onerror = (error) => {\n    console.error('Error ', error);\n  };\n\n  socket.onclose = (error) => {\n    console.error('Close ', error);\n  };\n}\n")),Object(a.b)("h2",{id:"connection"},"Connection"),Object(a.b)("p",null,"When opening a connection to a websocket, the parameters of the URL are validated like we do for HTTP requests, such as, endpoint name, key, origin, data access and authentication. If any of the checks fail, the connection fails and an error is sent to the user."),Object(a.b)("p",null,"If the endpoint is secure, your user needs to be logged in first. As the cookie with the access token is httOnly, it is sent automatically with the request."),Object(a.b)("h3",{id:"request-cookies"},"Request Cookies"),Object(a.b)("table",null,Object(a.b)("tr",null,Object(a.b)("td",null,"Header"),Object(a.b)("td",null,"Description"),Object(a.b)("td",null,"Required")),Object(a.b)("tr",null,Object(a.b)("td",null,o.ACCESS_TOKEN_COOKIE_NAME),Object(a.b)("td",null,"The Access token is required for secure endpoints.",Object(a.b)("p",null,"It is set when login in and is automatically sent in the websocket request."),Object(a.b)("p",null),Object(a.b)("p",null,"For more information check ",Object(a.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/secure-endpoints"}),"Secure Endpoints"),".")),Object(a.b)("td",null,"No"))),Object(a.b)("h3",{id:"request-parameters"},"Request Parameters"),Object(a.b)("p",null,"The following table describes the Request parameters to open a connection. Parameters not listed below are ignored."),Object(a.b)("p",null,"URL example: ",Object(a.b)("strong",{parentName:"p"},"wss"),"://",Object(a.b)("strong",{parentName:"p"},"app.rested.dev/api"),"/",Object(a.b)("strong",{parentName:"p"},"1"),"/",Object(a.b)("strong",{parentName:"p"},"ce"),"/",Object(a.b)("strong",{parentName:"p"},"examples/unsecure-endpoint"),"?key=",Object(a.b)("strong",{parentName:"p"},"d59eb2859c284168ac48aef65046d5dd")),Object(a.b)("table",null,Object(a.b)("tr",null,Object(a.b)("td",null,"Parameter"),Object(a.b)("td",null,"Description"),Object(a.b)("td",null,"Required")),Object(a.b)("tr",null,Object(a.b)("td",null,"protocol"),Object(a.b)("td",null,Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"wss"),":// -  Secure websocket over HTTPS.")),Object(a.b)("td",null,"Yes")),Object(a.b)("tr",null,Object(a.b)("td",null,"baseUrl"),Object(a.b)("td",null,"Base url for calling the API.",Object(a.b)("p",null,"Value: app.rested.dev/api")),Object(a.b)("td",null,"Yes")),Object(a.b)("tr",null,Object(a.b)("td",null,"versionNumber"),Object(a.b)("td",null,"Service version.",Object(a.b)("p",null,"Value: The current value is ",Object(a.b)("strong",{parentName:"p"},"1"),".")),Object(a.b)("td",null,"Yes")),Object(a.b)("tr",null,Object(a.b)("td",null,"customEndpointRoute"),Object(a.b)("td",null,"The route which identifies custom endpoints.",Object(a.b)("p",null,"Default value: ce")),Object(a.b)("td",null,"Yes")),Object(a.b)("tr",null,Object(a.b)("td",null,"userEndpoint"),Object(a.b)("td",null,"The endpoint name generated by the user.",Object(a.b)("p",null,"Value: the name created at ",Object(a.b)("a",{href:"https://app.rested.dev"},Object(a.b)("a",Object(n.a)({parentName:"p"},{href:"https://app.rested.dev"}),"https://app.rested.dev")))),Object(a.b)("td",null,"Yes")),Object(a.b)("tr",null,Object(a.b)("td",null,"apiKey"),Object(a.b)("td",null,"The API Key of the project."),Object(a.b)("td",null,"Yes")),Object(a.b)("tr",null,Object(a.b)("td",null,"accessToken"),Object(a.b)("td",null,"The access token received in the ",Object(a.b)("b",null,"Authorization"),' header after logging in. It should be sent without "Bearer ".'),Object(a.b)("td",null,"Yes - if the endpoint is secure and httpOnly cookie is not used."))),Object(a.b)("h2",{id:"response-data--messages"},"Response data / messages"),Object(a.b)("h3",{id:"error-codes"},"Error codes"),Object(a.b)("p",null,"The connection to the websocket can fail or be terminated due to one of the reasons listed in the table below. You will be able to read the error message in the ",Object(a.b)("inlineCode",{parentName:"p"},"reason")," property of the error message."),Object(a.b)("table",null,Object(a.b)("tr",null,Object(a.b)("td",null,"Error code"),Object(a.b)("td",null,"Description")),Object(a.b)("tr",null,Object(a.b)("td",null,"4000"),Object(a.b)("td",null,"Possible reasons:",Object(a.b)("ul",null,Object(a.b)("li",null,"Endpoint or API Key not valid."),Object(a.b)("li",null,"No Access token or invalid."),Object(a.b)("li",null,"Origin not allowed.")))),Object(a.b)("tr",null,Object(a.b)("td",null,"1000"),Object(a.b)("td",null,"Possible reasons:",Object(a.b)("ul",null,Object(a.b)("li",null,"Access token expired."),Object(a.b)("li",null,"Options of the endpoint are changed."))))),Object(a.b)("h3",{id:"successful-response"},"Successful response"),Object(a.b)("p",null,"If the connection is successful, when your endpoint receives new data or a record is modified, the connected client will receive the affected record in a WebSocket message. Below is an example of such message:"),Object(a.b)("pre",null,Object(a.b)("code",Object(n.a)({parentName:"pre"},{className:"language-javascript"}),'/*\ndata(received as a string):\ndata: "{"type":"POST","record":{"data":{"someNewData":"test"},"uniqueId":"3cc236ed09ef4768ba1fe6dcaf43edea","updatedAt":"2021-06-28T17:18:44.000Z","createdAt":"2021-06-28T17:18:44.000Z"}}"\n*/\n\n{\n    record: {\n        createdAt: "2021-06-28T17:18:44.000Z",\n        data: {\n            someNewData: "test"\n        },\n        uniqueId: "3cc236ed09ef4768ba1fe6dcaf43edea",\n        updatedAt: "2021-06-28T17:18:44.000Z",\n    },\n    type: "POST"\n}\n')),Object(a.b)("p",null,Object(a.b)("strong",{parentName:"p"},"Note:")," For files, if there are multiple uploads you will receive an array of records in the message."))}d.isMDXComponent=!0},271:function(e,t,s){const n=s(278),c=s(276),a="poaYUITERNM&XBnudycp\u20ac9TIFVAsadasdjikoihvA_SiyutrhgHJHGs#3jmndlkjMVfsdfsolasdbNC12X1257asd!QPLK3";t.ACCESS_TOKEN_COOKIE_NAME="__Secure-rested-access-token",t.COOKIE_EXPIRY_TIME=43200,t.decodeAccessToken=e=>{const t=n.decode(e,a),{sub:s,exp:o}=t;return{uniqueId:s,expiryDateUnix:c.unix(o)}},t.generateJWT=e=>{const t=c().add(43200,"minutes"),s={exp:t.unix(),iat:c().unix(),sub:e};return{accessToken:n.encode(s,a),expiresIn:t}}},277:function(e,t,s){var n={"./af":146,"./af.js":146,"./ar":147,"./ar-dz":148,"./ar-dz.js":148,"./ar-kw":149,"./ar-kw.js":149,"./ar-ly":150,"./ar-ly.js":150,"./ar-ma":151,"./ar-ma.js":151,"./ar-sa":152,"./ar-sa.js":152,"./ar-tn":153,"./ar-tn.js":153,"./ar.js":147,"./az":154,"./az.js":154,"./be":155,"./be.js":155,"./bg":156,"./bg.js":156,"./bm":157,"./bm.js":157,"./bn":158,"./bn.js":158,"./bo":159,"./bo.js":159,"./br":160,"./br.js":160,"./bs":161,"./bs.js":161,"./ca":162,"./ca.js":162,"./cs":163,"./cs.js":163,"./cv":164,"./cv.js":164,"./cy":165,"./cy.js":165,"./da":166,"./da.js":166,"./de":167,"./de-at":168,"./de-at.js":168,"./de-ch":169,"./de-ch.js":169,"./de.js":167,"./dv":170,"./dv.js":170,"./el":171,"./el.js":171,"./en-au":172,"./en-au.js":172,"./en-ca":173,"./en-ca.js":173,"./en-gb":174,"./en-gb.js":174,"./en-ie":175,"./en-ie.js":175,"./en-il":176,"./en-il.js":176,"./en-nz":177,"./en-nz.js":177,"./eo":178,"./eo.js":178,"./es":179,"./es-do":180,"./es-do.js":180,"./es-us":181,"./es-us.js":181,"./es.js":179,"./et":182,"./et.js":182,"./eu":183,"./eu.js":183,"./fa":184,"./fa.js":184,"./fi":185,"./fi.js":185,"./fo":186,"./fo.js":186,"./fr":187,"./fr-ca":188,"./fr-ca.js":188,"./fr-ch":189,"./fr-ch.js":189,"./fr.js":187,"./fy":190,"./fy.js":190,"./gd":191,"./gd.js":191,"./gl":192,"./gl.js":192,"./gom-latn":193,"./gom-latn.js":193,"./gu":194,"./gu.js":194,"./he":195,"./he.js":195,"./hi":196,"./hi.js":196,"./hr":197,"./hr.js":197,"./hu":198,"./hu.js":198,"./hy-am":199,"./hy-am.js":199,"./id":200,"./id.js":200,"./is":201,"./is.js":201,"./it":202,"./it.js":202,"./ja":203,"./ja.js":203,"./jv":204,"./jv.js":204,"./ka":205,"./ka.js":205,"./kk":206,"./kk.js":206,"./km":207,"./km.js":207,"./kn":208,"./kn.js":208,"./ko":209,"./ko.js":209,"./ky":210,"./ky.js":210,"./lb":211,"./lb.js":211,"./lo":212,"./lo.js":212,"./lt":213,"./lt.js":213,"./lv":214,"./lv.js":214,"./me":215,"./me.js":215,"./mi":216,"./mi.js":216,"./mk":217,"./mk.js":217,"./ml":218,"./ml.js":218,"./mn":219,"./mn.js":219,"./mr":220,"./mr.js":220,"./ms":221,"./ms-my":222,"./ms-my.js":222,"./ms.js":221,"./mt":223,"./mt.js":223,"./my":224,"./my.js":224,"./nb":225,"./nb.js":225,"./ne":226,"./ne.js":226,"./nl":227,"./nl-be":228,"./nl-be.js":228,"./nl.js":227,"./nn":229,"./nn.js":229,"./pa-in":230,"./pa-in.js":230,"./pl":231,"./pl.js":231,"./pt":232,"./pt-br":233,"./pt-br.js":233,"./pt.js":232,"./ro":234,"./ro.js":234,"./ru":235,"./ru.js":235,"./sd":236,"./sd.js":236,"./se":237,"./se.js":237,"./si":238,"./si.js":238,"./sk":239,"./sk.js":239,"./sl":240,"./sl.js":240,"./sq":241,"./sq.js":241,"./sr":242,"./sr-cyrl":243,"./sr-cyrl.js":243,"./sr.js":242,"./ss":244,"./ss.js":244,"./sv":245,"./sv.js":245,"./sw":246,"./sw.js":246,"./ta":247,"./ta.js":247,"./te":248,"./te.js":248,"./tet":249,"./tet.js":249,"./tg":250,"./tg.js":250,"./th":251,"./th.js":251,"./tl-ph":252,"./tl-ph.js":252,"./tlh":253,"./tlh.js":253,"./tr":254,"./tr.js":254,"./tzl":255,"./tzl.js":255,"./tzm":256,"./tzm-latn":257,"./tzm-latn.js":257,"./tzm.js":256,"./ug-cn":258,"./ug-cn.js":258,"./uk":259,"./uk.js":259,"./ur":260,"./ur.js":260,"./uz":261,"./uz-latn":262,"./uz-latn.js":262,"./uz.js":261,"./vi":263,"./vi.js":263,"./x-pseudo":264,"./x-pseudo.js":264,"./yo":265,"./yo.js":265,"./zh-cn":266,"./zh-cn.js":266,"./zh-hk":267,"./zh-hk.js":267,"./zh-tw":268,"./zh-tw.js":268};function c(e){var t=a(e);return s(t)}function a(e){if(!s.o(n,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return n[e]}c.keys=function(){return Object.keys(n)},c.resolve=a,e.exports=c,c.id=277},280:function(e,t){},281:function(e,t){},282:function(e,t){},283:function(e,t){},284:function(e,t){},285:function(e,t){},286:function(e,t){},287:function(e,t){},288:function(e,t){},289:function(e,t){},290:function(e,t){},291:function(e,t){}}]);